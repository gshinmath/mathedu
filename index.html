<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>성취기준 문제 출제기 — [영역] [코드] [주제]</title>
<style>
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR,sans-serif;background:#0b1020;color:#eaf1ff}
header{padding:18px;text-align:center}
.card{background:#121831;border:1px solid #1f2a4d;border-radius:16px;padding:14px;margin:14px auto;max-width:980px}
.row{display:flex;align-items:center;gap:8px}
.meta{display:flex;flex-wrap:wrap;gap:10px;align-items:center;font-size:16px;margin-bottom:10px}
.meta .label{color:#94a3b8}
.meta .val{background:#1f2a4d;padding:4px 8px;border-radius:8px;font-family:ui-monospace}
.meta .kw{background:#0e1530;border:1px solid #27345f;border-radius:12px;padding:2px 8px;font-size:13px;color:#cbd5e1}
.nav{display:flex;align-items:center;gap:8px;justify-content:space-between;margin:8px 0}
.pill{border:1px solid #27345f;border-radius:999px;padding:.2rem .6rem;color:#94a3b8;font-size:12px}
.btn{border:0;border-radius:10px;padding:8px 14px;cursor:pointer;font-weight:600;color:#eaf1ff;background:#1e3a8a}
.btn:hover{filter:brightness(1.1)}
.btn.ghost{background:#17203f;border:1px solid #27345f}
.btn:disabled{opacity:.5;cursor:not-allowed}
.badge{border-radius:6px;padding:3px 6px;font-size:12px;margin-left:6px}
.ok{background:#0f2b20;color:#a7f3d0;border:1px solid #195b47}
.ng{background:#2a0f15;color:#ffd2d2;border:1px solid #7f1d1d}
#refBox{display:none;margin-top:10px;padding:10px;border:1px dashed #27345f;border-radius:12px;background:#0e1530}
#scoreInfo{margin-top:6px;color:#cbd5e1}
hr{border:none;height:1px;background:#1f2a4d;margin:12px 0}
#accWrap{display:none;margin-top:6px}
.meter{height:12px;background:#0e1530;border:1px solid #27345f;border-radius:999px;overflow:hidden}
.meter>span{display:block;height:100%;width:0%}
.legend{display:flex;justify-content:space-between;color:#94a3b8;font-size:11px;margin-top:4px}
#progWrap{margin-top:6px}
#progBar{height:8px;background:#0e1530;border:1px solid #27345f;border-radius:999px;overflow:hidden}
#progBar>span{display:block;height:100%;width:0%;background:linear-gradient(90deg,#3b82f6,#22d3ee,#34d399)}
textarea{width:100%;min-height:150px;background:#0e1530;color:#eaf1ff;border:1px solid #27345f;border-radius:12px;padding:10px}
footer{color:#94a3b8;text-align:center;font-size:13px;margin:20px 0}
</style>
</head>
<body>
<header>
  <h1>성취기준 문제 출제기(베타버전)</h1>
  <div style="color:#94a3b8;font-size:14px">문항 머리말: <b>[영역] [코드] [주제]</b> 형식 표시</div>
</header>

<div class="card">
  <!-- 머리말: [영역] [코드] [키워드] -->
  <div class="meta" id="metaBar">
    <span class="label">[영역]</span>
    <span class="val" id="areaView">-</span>
    <span class="label">[코드]</span>
    <span class="val" id="codeView">-</span>
    <span class="label">[주제]</span>
    <span class="val" id="topicView">-</span>
  </div>

  <!-- 문항 네비게이션 -->
  <div class="nav">
    <div class="row" style="gap:8px">
      <button class="btn ghost" id="btnPrev">← 이전</button>
      <button class="btn" id="btnNext">다음 →</button>
      <button class="btn ghost" id="btnShuffle">섞기</button>
      <button class="btn ghost" id="btnReset">원래 순서</button>
    </div>
    <div class="row" style="gap:8px">
      <span class="pill">문항 <b id="posNow">1</b>/<span id="posTotal">-</span></span>
      <span class="pill">정답 <b id="hitCnt">0</b></span>
      <span class="pill">평균 <b id="avgScore">0.00</b></span>
    </div>
  </div>
  <div id="progWrap"><div id="progBar"><span id="progFill"></span></div></div>

  <div style="color:#cbd5e1;font-size:14px;margin:10px 0 6px">정답 문구 전체 일치가 아니어도 의미가 맞으면 정답 처리합니다.</div>

  <!-- 응답 입력 -->
  <textarea id="answer" placeholder="이 성취기준의 해설을 입력하세요..."></textarea>

  <!-- 조작 버튼/판정 -->
  <div class="row" style="justify-content:space-between;margin-top:8px">
    <div class="row" style="gap:8px">
      <button class="btn" id="btnScore">채점</button>
      <button class="btn" id="btnShowRef">정답 보기</button>
    </div>
    <div><span class="badge" id="passBadge">미채점</span></div>
  </div>

  <!-- 점수/정답 -->
  <div id="scoreInfo"></div>
  <div id="hkHint" style="margin-top:6px;color:#94a3b8;font-size:12px">↩︎ <b>엔터</b>=채점 · ⇧+엔터=줄바꿈 · <b>N</b>/→=다음 · <b>P</b>/←=이전 · <b>Ctrl/Cmd+Enter</b>=채점</div>
  <div id="accWrap">
    <div class="meter" aria-label="accuracy meter"><span id="accBar"></span></div>
    <div class="legend"><span>0%</span><span>60% 임계</span><span>100%</span></div>
  </div>
  <div id="refBox">
    <div style="color:#cbd5e1;margin-bottom:4px">정답(기준 해설)</div>
    <div id="refText" style="white-space:pre-wrap;font-size:14px"></div>
  </div>
</div>

<footer>
  Made by <b>Shin</b><br>임용 파이팅! 임용 전 진짜 마지막 선물<br>서원대학교 수학교육과
</footer>

<script>
// ===== 문항 은행 =====
const BANK=[
  // 수와 연산
  { area:"수와 연산", code:"9수01-02", keywords:["최대공약수와 최소공배수"], ref:"초등학교에서 학습한 최대공약수와 최소공배수의 개념을 바탕으로 소인수분해를 이용하여 최대공약수와 최소공배수를 구하게 한다. 최대공약수와 최소공배수는 자연수의 소인수분해를 이용하는 범위에서 다루고, 최대공약수와 최소공배수의 활용 문제는 다루지 않는다." },
  { area:"수와 연산", code:"9수01-05", keywords:["정수의 사칙계산"], ref:"정수의 사칙계산의 원리는 여러 가지 모델을 이용하여 직관적으로 이해하게 하고, 실생활에서 사칙계산의 유용성을 인식하게 한다." },
  { area:"수와 연산", code:"9수01-06", keywords:["순환소수 관련"], ref:"순환소수를 분수로 고치는 것은 순환소수가 유리수임을 이해할 수 있는 정도로 다룬다. 유한소수를 순환소수로 나타내는 것은 다루지 않는다." },
  { area:"수와 연산", code:"9수01-08", keywords:["무리수, 실수"], ref:"실생활에서 사용되는 무리수의 예를 찾아보는 활동을 통해 무리수의 필요성과 유용성을 인식하게 한다. 실수는 유리수와 무리수로 이루어짐을 이해하게 하고, 수 체계의 논리적인 아름다움에 관심을 갖게 한다." },

  // 변화와 관계
  { area:"변화와 관계", code:"9수02-05", keywords:["좌표, 좌표평면"], ref:"실생활에서 좌표가 사용되는 예를 찾아보고 이를 수직선과 좌표평면 위에 표현해 보며, 그 유용성과 편리함을 인식하게 한다." },
  { area:"변화와 관계", code:"9수02-06", keywords:["그래프"], ref:"다양한 상황을 그래프로 나타내어 증가와 감소, 주기적 변화 등 변화 상태를 쉽게 파악할 수 있게 한다. 주어진 그래프를 해석하여 그래프가 나타내는 상황을 설명하게 함으로써 그래프의 유용성을 인식하게 한다." },
  { area:"변화와 관계", code:"9수02-07", keywords:["정비례, 반비례"], ref:"속력과 거리, 속력과 시간과 같은 실생활의 예를 통해 정비례와 반비례 관계를 직관적으로 이해하게 하고, 정비례와 반비례 관계가 성립하는 실생활의 예를 찾아 설명하게 한다." },
  { area:"변화와 관계", code:"9수02-08", keywords:["지수법칙"], ref:"지수법칙은 지수가 자연수인 범위에서 단항식의 곱셈과 나눗셈을 하는 데 필요한 정도로 다룬다." },
  { area:"변화와 관계", code:"9수02-10", keywords:["다항식 나눗셈"], ref:"다항식의 나눗셈에서는 다항식을 단항식으로 나누어 그 몫이 다항식이 되는 경우만 다룬다." },
  { area:"변화와 관계", code:"9수02-19", keywords:["다항식의 곱셈과 인수분해"], ref:"다항식의 곱셈과 다항식의 인수분해의 역관계를 이해하고, 이와 유사한 관계를 찾아보는 활동을 하게 한다. 다항식의 곱셈과 인수분해는 다음의 경우를 다룬다." },
  { area:"변화와 관계", code:"9수02-22", keywords:["이차함수의 최대, 최소"], ref:"이차함수 에서 최댓값과 최솟값은 의 범위가 실수 전체인 경우만 다룬다." },

  // 도형과 측정
  { area:"도형과 측정", code:"9수03-01", keywords:["점·선·면·각 지도"], ref:"점, 선, 면, 각과 관련된 용어는 다양한 상황에서 직관적으로 이해하게 한다." },
  { area:"도형과 측정", code:"9수03-03", keywords:["삼각형 작도"], ref:"주어진 삼각형과 합동인 삼각형을 작도하는 활동을 하고, 자신의 방법을 설명하게 한다." },
  { area:"도형과 측정", code:"9수03-05", keywords:["다각형의 성질"], ref:"삼각형의 내각과 외각의 크기, 다각형의 내각과 외각의 크기의 합, 다각형의 대각선의 개수를 구하는 과정을 탐구하여 다각형의 성질을 추측하고 일반화할 수 있게 한다." },
  { area:"도형과 측정", code:"9수03-07", keywords:["다면체·회전체 지도"], ref:"구체적인 사물, 전개도, 교구, 컴퓨터 프로그램 등을 이용하여 다면체와 회전체를 관찰하고 그 성질을 탐구하게 한다. 회전체 단면의 모양은 회전체의 성질을 이해하는 데 필요한 정도로 다룬다." },
  { area:"도형과 측정", code:"9수03-09", keywords:["이등변 삼각형 성질 지도"], ref:"종이접기, 작도, 공학 도구 등을 이용하여 이등변삼각형의 성질을 추측하게 하고, 그 성질을 삼각형의 합동 조건을 이용하여 정당화할 수 있게 한다. 이때, 증명이라는 용어를 도입하고, 그 필요성을 인식하게 한다." },
  { area:"도형과 측정", code:"9수03-11", keywords:["사각형 성질 지도"], ref:"사각형의 성질은 대각선에 관한 성질을 위주로 다룬다. 여러 가지 사각형의 성질을 통해 사각형 사이의 관계를 설명하게 한다." },
  { area:"도형과 측정", code:"9수03-15", keywords:["피타고라스 정리"], ref:"피타고라스 정리는 다양한 활동을 통하여 추측하고 정당화할 수 있게 한다. 피타고라스 정리의 역은 직관적으로 이해하게 하고, 이를 이용하여 세 변의 길이가 주어진 삼각형이 직각삼각형인지 판별하게 한다." },
  { area:"도형과 측정", code:"9수03-17", keywords:["삼각비 활용"], ref:"삼각비를 활용하여 직접 측정하기 어려운 거리나 높이 등을 구해 보는 활동을 통해 유용성을 인식하고 흥미를 느낄 수 있게 한다." },

  // 자료와 가능성
  { area:"자료와 가능성", code:"9수04-01", keywords:["대푯값"], ref:"대푯값에는 초등학교에서 학습한 평균 이외에도 중앙값, 최빈값이 있음을 알고 그 필요성을 인식하게 한다. 자료의 특성에 따라 적절한 대푯값을 선택하여 구해 보고, 각 대푯값이 어떤 상황에서 유용하게 사용될 수 있는지 토론하게 한다." },
  { area:"자료와 가능성", code:"9수04-03", keywords:["상대도수"], ref:"상대도수는 도수의 총합이 다른 두 집단의 분포를 비교하는 상황에서 간단히 다루고, 상대도수의 필요성과 유용성을 인식하게 한다." },
  { area:"자료와 가능성", code:"9수04-04", keywords:["통계적 탐구 문제 해결"], ref:"다양한 맥락에서 해결하고자 하는 통계적 탐구 문제를 설정하고 적절한 계획을 세워 자료를 수집하게 한다. 수집한 자료를 자료의 특성과 목적에 맞게 표, 그래프, 수치 등으로 나타내어 분석하고, 그 결과를 탐구 문제와 연결하여 해석하게 한다. 자료를 수집하고 분석할 때는 인터넷 검색, 웹 기반 소프트웨어, 통계 프로그램 등을 활용하게 한다. 수집한 자료나 분석 결과가 적절한지 판단하여 계획을 수정하고, 통계적 근거를 바탕으로 토론하는 등 통계적 문제해결 과정에 주도적으로 참여하게 한다." },
  { area:"자료와 가능성", code:"9수04-05", keywords:["경우의 수 지도 관련"], ref:"경우의 수는 두 경우의 수를 합하거나 곱하는 경우 정도로만 다루고, 순열과 조합을 이용하면 쉽게 해결되는 등의 복잡한 경우의 수를 구하는 문제는 다루지 않는다." },
  { area:"자료와 가능성", code:"9수04-06", keywords:["확률 개념 지도"], ref:"확률은 실험이나 관찰을 통해 구한 상대도수로서의 의미와 경우의 수의 비율로서의 의미를 연결하여 이해하게 한다. 경우의 수의 비율로 확률을 다룰 때, 각 경우가 발생할 가능성이 동등하다는 것을 가정한다는 점에 유의하게 한다." },
  { area:"자료와 가능성", code:"9수04-08", keywords:["상자그림"], ref:"상자그림을 다룰 때는 두 집단의 분포를 비교하고 해석하는 활동에 중점을 두고, 이를 통해 상자그림의 유용성을 인식하게 한다." },
  { area:"자료와 가능성", code:"9수04-09", keywords:["상관관계"], ref:"상관관계는 양의 상관관계, 음의 상관관계, 상관관계가 없는 경우로 구분하여 다룬다." }
]; 

// 키워드 의미 매칭 보강(패턴)
const KEYPAT = {
  "9수01-06": {
    "순환소수→분수": [
      "순환\\s*소수.{0,10}분수",
      "분수.{0,10}순환\\s*소수",
      "순환\\s*소수를?\\s*분수(로|로\\s*고치|로\\s*바꾸)"
    ],
    "유리수 이해": [
      "유리수.*이해",
      "이해.*유리수",
      "유리수임을.*이해"
    ],
    "유한소수→순환소수 제외": [
      "유한\\s*소수.*순환\\s*소수.*(다루지\\s*않|제외)",
      "유한\\s*소수를?\\s*순환\\s*소수(로)?\\s*나타내는\\s*것.*(다루지\\s*않|제외)"
    ]
  }
};

// ===== 상태 및 결과 저장 구조 =====
const ORDER_INIT = BANK.map((_,i)=>i);
let ORDER = [...ORDER_INIT]; // 현재 출제 순서(섞기/복원)
let POS = 0; // ORDER 내 현재 위치
const RESULTS = Array(BANK.length).fill(null); // {ans, score, pass}

// ===== 엘리먼트 참조 =====
const els={
  area:document.querySelector('#areaView'),
  code:document.querySelector('#codeView'),
  topic:document.querySelector('#topicView'),
  ans:document.querySelector('#answer'),
  badge:document.querySelector('#passBadge'),
  refBox:document.querySelector('#refBox'),
  refText:document.querySelector('#refText'),
  scoreInfo:document.querySelector('#scoreInfo'),
  posNow:document.querySelector('#posNow'),
  posTotal:document.querySelector('#posTotal'),
  hitCnt:document.querySelector('#hitCnt'),
  avgScore:document.querySelector('#avgScore'),
  progFill:document.querySelector('#progFill'),
  btnPrev:document.querySelector('#btnPrev'),
  btnNext:document.querySelector('#btnNext')
};
els.posTotal.textContent = ORDER.length;

function currentIndex(){ return ORDER[POS]; }

// ===== 렌더 =====
function renderQ(){
  const q = BANK[currentIndex()];
  els.area.textContent=q.area||'-';
  els.code.textContent=q.code||'-';
  els.topic.textContent = (q.keywords||[]).join(' · ') || '-';
  // 응답 복원
  const saved = RESULTS[currentIndex()];
  els.ans.value = saved?.ans || '';
  // 판정 및 보조뷰 초기화/복원
  els.badge.textContent = saved? (saved.pass?'정답':'미달') : '미채점';
  els.badge.className = 'badge' + (saved? (' ' + (saved.pass?'ok':'ng')) : '');
  els.scoreInfo.textContent = saved? `정확도: ${(saved.score*100).toFixed(1)}% (임계값 60%)` : '';
  const bar = document.getElementById('accBar');
  if(saved){ setAccBar(saved.score); document.getElementById('accWrap').style.display='block'; } else { document.getElementById('accWrap').style.display='none'; bar.style.width='0%'; bar.style.background=''; }
  els.refBox.style.display = saved? 'block':'none';
  els.refText.textContent = saved? BANK[currentIndex()].ref : '';
  updateNav();
}

function updateNav(){
  els.posNow.textContent = POS+1;
  const done = RESULTS.filter(Boolean);
  const hits = done.filter(r=>r.pass).length;
  const avg = done.length? done.reduce((a,r)=>a+r.score,0)/done.length : 0;
  els.hitCnt.textContent = hits;
  els.avgScore.textContent = avg.toFixed(2);
  // 진행도 바: 현재 위치 기준
  const pct = (ORDER.length<=1)? 0 : POS/(ORDER.length-1);
  els.progFill.style.width = (pct*100)+'%';
  // 버튼 상태
  els.btnPrev.disabled = (POS===0);
  els.btnNext.disabled = (POS===ORDER.length-1);
}

// ===== 유틸 =====
function shuffle(arr){ const a=[...arr]; for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } return a; }

// ===== 채점 로직 =====
function calcAccuracy(ans, ref, keywords){
  // 보조함수: 텍스트 정규화(느슨한 의미 매칭용)
  function normalizeText(s){
    return (s||'').toLowerCase()
      .replace(/[\[\](){}<>"'`]/g,' ')
      .replace(/[.,!?;:/~_^%·•+\-]/g,' ')
      .replace(/임을/g,' ') // '유리수임을' 등 표현 완화
      .replace(/\s+/g,' ')
      .trim();
  }
  // 키워드 스코어: 코드별 패턴이 있으면 정규식 매칭, 없으면 포함 검사
  function kwScore(ansRaw, code, keywords){
    const map = KEYPAT[code];
    if(map){
      const labels = Object.keys(map);
      let hit = 0;
      for(const lab of labels){
        const pats = map[lab].map(p=>new RegExp(p,'i'));
        if(pats.some(rx=> rx.test(ansRaw))) hit++;
      }
      return labels.length? hit/labels.length : 0;
    }
    const total = (keywords||[]).length || 1;
    const hits = (keywords||[]).filter(k=> ansRaw.includes(k)).length;
    return hits/total;
  }

  // 3-그램 유사도(공백 제거)
  const A=ans.replace(/\s+/g,''); const R=ref.replace(/\s+/g,'');
  let hit=0; for(let i=0;i<A.length-2;i++){ const tri=A.slice(i,i+3); if(R.includes(tri)) hit++; }
  const ngram = (R.length>2)? hit/(R.length-2) : 0;

  // 키워드/패턴 매칭 (코드별 의미 패턴 적용)
  const kw = kwScore(normalizeText(ans), document.querySelector('#codeView').textContent, keywords);
  return 0.5*ngram + 0.5*kw;
}

function score(){
  const qi = currentIndex();
  const q = BANK[qi];
  const ans = els.ans.value.trim();
  if(!ans){ alert('응답을 입력하세요.'); return; }
  const s = calcAccuracy(ans,q.ref,q.keywords);
  const pass = s>=0.6;
  RESULTS[qi] = {ans, score:s, pass};
  // 즉시 반영
  els.badge.textContent = pass?'정답':'미달';
  els.badge.className = 'badge ' + (pass?'ok':'ng');
  els.scoreInfo.textContent = `정확도: ${(s*100).toFixed(1)}% (임계값 60%)`;
  els.refText.textContent = q.ref; els.refBox.style.display='block';
  setAccBar(s);
  updateNav();
}

function setAccBar(s){
  const wrap=document.getElementById('accWrap');
  const bar=document.getElementById('accBar');
  const pct=(Math.max(0,Math.min(1,s))*100).toFixed(1)+'%';
  const hue = Math.max(0, Math.min(120, Math.round(s*120)));
  bar.style.width=pct;
  bar.style.background = `linear-gradient(90deg, hsl(${hue}, 85%, 55%), hsl(${hue}, 85%, 45%))`;
  wrap.style.display='block';
}

// ===== 네비게이션 핸들러 =====
function goNext(){ if(POS<ORDER.length-1){ POS++; renderQ(); }}
function goPrev(){ if(POS>0){ POS--; renderQ(); }}
function doShuffle(){ ORDER = shuffle(ORDER); POS = 0; renderQ(); }
function resetOrder(){ ORDER = [...ORDER_INIT]; POS = 0; renderQ(); }

document.querySelector('#btnScore').onclick=score;
document.querySelector('#btnShowRef').onclick=()=>{ const q=BANK[currentIndex()]; els.refText.textContent=q.ref; els.refBox.style.display='block'; };
document.querySelector('#btnNext').onclick=goNext;
document.querySelector('#btnPrev').onclick=goPrev;
document.querySelector('#btnShuffle').onclick=doShuffle;
document.querySelector('#btnReset').onclick=resetOrder;

// 키보드 단축키 설정
// 1) 입력창: 엔터=채점 (Shift+Enter는 줄바꿈 유지)
els.ans.addEventListener('keydown', e=>{
  if(e.key==='Enter' && !e.shiftKey && !e.ctrlKey && !e.metaKey && !e.altKey){
    e.preventDefault();
    score();
  }
});

// 2) 전역 단축키: N/→=다음, P/←=이전, Ctrl/Cmd+Enter=채점
addEventListener('keydown',e=>{
  const typing = document.activeElement === els.ans;
  if(e.key==='ArrowRight' || (!typing && e.key.toLowerCase()==='n')){ e.preventDefault(); goNext(); }
  else if(e.key==='ArrowLeft' || (!typing && e.key.toLowerCase()==='p')){ e.preventDefault(); goPrev(); }
  else if((e.key==='Enter') && (e.ctrlKey||e.metaKey)){ e.preventDefault(); score(); }
});

// 초기 렌더
renderQ();
</script>
</body>
</html>
